local libdaemon = require('libdaemon')
local component = require('component')

local DEFAULT = {
	PORT = 7,
	TMOUT = 1,
}

local dmn = libdaemon.new('heartbeat')

dmn.init = function(self, prt, tmout)
	if prt == nil then prt = DEFAULT.PORT end
	prt = tonumber(prt)
	if tmout == nil then tmout = DEFAULT.TMOUT end
	tmout = tonumber(tmout)
	self.prt = prt
	self.tmout = tmout
	self:timer(self.tmout, function()
		for cm in component.list("modem") do
			component.invoke(cm, "broadcast", self.port, 'HB', computer.address(), computer.uptime())
		end
		for cm in component.list("tunnel") do
			component.invoke(cm, "send", 'HB', computer.address(), computer.uptime())
		end
	end)
end
